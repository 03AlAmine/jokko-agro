<div class="products-container">
  <!-- Main Content -->
  <main class="main-content">
    <!-- En-tÃªte -->
    <div class="page-header">
      <div class="header-left">
        <h1><span class="header-icon">ğŸ“¦</span> Mes produits</h1>
        <p class="subtitle">GÃ©rez tous vos produits en vente</p>
      </div>
      <div class="header-right">
        <button routerLink="/producer/add-product" class="add-product-btn">
          <span class="btn-icon">â•</span> Nouveau produit
        </button>
      </div>
    </div>

    <!-- Statistiques rapides -->
    <div class="quick-stats">
      <div class="stat-card">
        <div class="stat-icon total">ğŸ“¦</div>
        <div class="stat-info">
          <h3>{{ getTotalProductsCount() }}</h3>
          <p>Produits au total</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon available">âœ…</div>
        <div class="stat-info">
          <h3>{{ getAvailableProductsCount() }}</h3>
          <p>Produits disponibles</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon value">ğŸ’°</div>
        <div class="stat-info">
          <h3>{{ getTotalValueSum().toLocaleString() }} FCFA</h3>
          <p>Valeur totale en stock</p>
        </div>
      </div>
    </div>

    <!-- Barre de filtres -->
    <div class="filters-section">
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (ngModelChange)="applyFilters()"
          placeholder="Rechercher un produit..."
          class="search-input"
        />
      </div>

      <div class="filter-controls">
        <div class="filter-group">
          <label>CatÃ©gorie:</label>
          <select
            [(ngModel)]="selectedCategory"
            (ngModelChange)="applyFilters()"
            title="categorie"
          >
            <option *ngFor="let cat of categories" [value]="cat.id">
              {{ cat.icon }} {{ cat.name }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label>Statut:</label>
          <select
            [(ngModel)]="selectedStatus"
            (ngModelChange)="applyFilters()"
            title="statut"
          >
            <option *ngFor="let status of statuses" [value]="status.id">
              {{ status.name }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label>Trier par:</label>
          <select
            [(ngModel)]="sortBy"
            (ngModelChange)="applyFilters()"
            title="trie"
          >
            <option *ngFor="let option of sortOptions" [value]="option.id">
              {{ option.name }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Liste des produits -->
    <div class="products-section">
      <div class="section-header">
        <h2>Produits ({{ filteredProducts.length }})</h2>
        <div class="actions">
          <button (click)="loadProducts()" class="action-btn refresh">
            ğŸ”„ Actualiser
          </button>
        </div>
      </div>

      <div *ngIf="isLoading" class="loading">
        <div class="spinner"></div>
        <p>Chargement des produits...</p>
      </div>

      <div
        *ngIf="!isLoading && filteredProducts.length === 0"
        class="empty-state"
      >
        <div class="empty-icon">ğŸ“¦</div>
        <h3>Aucun produit trouvÃ©</h3>
        <p *ngIf="products.length === 0">
          Vous n'avez pas encore ajoutÃ© de produits.
        </p>
        <p *ngIf="products.length > 0">
          Aucun produit ne correspond Ã  vos critÃ¨res de recherche.
        </p>
        <button routerLink="/producer/add-product" class="btn-primary">
          â• Ajouter votre premier produit
        </button>
      </div>

      <div class="products-grid">
        <div *ngFor="let product of filteredProducts" class="product-card">
          <!-- En-tÃªte de la carte -->
          <div class="product-header">
            <div class="product-image">
              {{ getCategoryIcon(product.category) }}
              <span
                *ngIf="product.isOrganic"
                class="certified-badge"
                title="Produit bio"
                >ğŸŒ±</span
              >
              <span
                *ngIf="product.certifications?.includes('fairtrade')"
                class="certified-badge"
                title="Commerce Ã©quitable"
                >âš–ï¸</span
              >
            </div>
            <div class="product-meta">
              <span class="category-badge">
                {{ getCategoryName(product.category) }}
              </span>
              <span [class]="'status-badge ' + getStatusClass(product.status)">
                {{ getStatusText(product.status) }}
              </span>
            </div>
          </div>

          <!-- Corps de la carte -->
          <div class="product-body">
            <h3 class="product-name">{{ product.name }}</h3>

            <p class="product-description" *ngIf="product.description">
              {{ product.description.length > 100 ? (product.description |
              slice:0:100) + '...' : product.description }}
            </p>

            <div class="product-details">
              <div class="detail-row">
                <span class="detail-label">Prix unitaire:</span>
                <span class="detail-value"
                  >{{ product.price.toLocaleString() }} FCFA/{{ product.unit
                  }}</span
                >
              </div>
              <div class="detail-row">
                <span class="detail-label">QuantitÃ©:</span>
                <span class="detail-value">
                  {{ product.quantity }} {{ product.unit }}
                </span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Valeur totale:</span>
                <span class="detail-value highlight">
                  {{ getTotalValue(product).toLocaleString() }} FCFA
                </span>
              </div>
            </div>

            <div class="product-stats">
              <div class="stat">
                <span class="stat-icon">ğŸ’°</span>
                <span class="stat-value">{{ product.sales }} ventes</span>
              </div>
              <div class="stat">
                <span class="stat-icon">â­</span>
                <span class="stat-value">{{ product.rating || 0 }}/5</span>
              </div>
              <div class="stat">
                <span class="stat-icon">ğŸ“…</span>
                <span class="stat-value">
                  {{ product.updatedAt | date:'dd/MM/yy' }}
                </span>
              </div>
            </div>

            <!-- Tags de certifications -->
            <div
              class="product-tags"
              *ngIf="product.certifications?.length || product.isOrganic"
            >
              <span *ngIf="product.isOrganic" class="tag organic">ğŸŒ± Bio</span>
              <span
                *ngFor="let cert of product.certifications"
                [class]="'tag ' + cert"
              >
                {{ cert === 'organic' ? 'ğŸŒ± Bio' : cert === 'local' ? 'ğŸ“ Local'
                : cert === 'fairtrade' ? 'âš–ï¸ Ã‰quitable' : cert === 'seasonal' ?
                'ğŸŒ Saison' : cert }}
              </span>
            </div>
          </div>

          <!-- Actions -->
          <div class="product-actions">
            <button class="action-btn edit" (click)="editProduct(product.id!)">
              âœï¸ Modifier
            </button>
            <button
              class="action-btn view"
              [routerLink]="['/producer/product', product.id]"
            >
              ğŸ‘ï¸ Voir
            </button>
            <div class="dropdown">
              <button class="action-btn more">â‹¯</button>
              <div class="dropdown-menu">
                <button
                  (click)="duplicateProduct(product.id!)"
                  class="dropdown-item"
                >
                  ğŸ“‹ Dupliquer
                </button>
                <button
                  *ngIf="product.status === 'available'"
                  (click)="updateStatus(product.id!, 'sold_out')"
                  class="dropdown-item"
                >
                  â¸ï¸ Marquer Ã©puisÃ©
                </button>
                <button
                  *ngIf="product.status === 'sold_out'"
                  (click)="updateStatus(product.id!, 'available')"
                  class="dropdown-item"
                >
                  âœ… RÃ©activer
                </button>
                <div class="dropdown-divider"></div>
                <button
                  (click)="deleteProduct(product.id!)"
                  class="dropdown-item delete"
                >
                  ğŸ—‘ï¸ Supprimer
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Conseils -->
    <div class="tips-section">
      <div class="tip-card">
        <h3>ğŸ’¡ Conseils de gestion</h3>
        <ul>
          <li>Mettez Ã  jour rÃ©guliÃ¨rement les quantitÃ©s en stock</li>
          <li>Utilisez des descriptions dÃ©taillÃ©es pour vos produits</li>
          <li>Activez les certifications pour augmenter la confiance</li>
          <li>Surveillez les ventes pour rÃ©approvisionner Ã  temps</li>
        </ul>
      </div>
      <div class="tip-card" *ngIf="getTopSellingProducts().length > 0">
        <h3>ğŸ“Š Produits les plus vendus</h3>
        <ol>
          <li *ngFor="let product of getTopSellingProducts()">
            {{ product.name }} - {{ product.sales }} ventes
          </li>
        </ol>
      </div>
    </div>
  </main>
</div>
