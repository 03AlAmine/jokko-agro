<div class="sales-container">

  <!-- Main Content -->
  <main class="main-content">
    <!-- En-t√™te -->
    <div class="page-header">
      <div class="header-left">
        <h1><span class="header-icon">üí∞</span> Historique des ventes</h1>
        <p class="subtitle">Suivez vos performances et vos revenus</p>
      </div>
      <div class="header-right">
        <button class="export-btn" (click)="exportSales()">
          <span class="btn-icon">üìÑ</span> Exporter
        </button>
      </div>
    </div>

    <!-- Statistiques principales -->
    <div class="main-stats">
      <div class="main-stat-card revenue">
        <div class="stat-icon">üí∞</div>
        <div class="stat-content">
          <h3>{{ getTotalRevenue().toLocaleString() }} FCFA</h3>
          <p>Revenu total</p>
          <span class="trend up">‚Üë 15% ce mois</span>
        </div>
      </div>

      <div class="main-stat-card sales">
        <div class="stat-icon">üìà</div>
        <div class="stat-content">
          <h3>{{ sales.length }}</h3>
          <p>Commandes totales</p>
          <span class="trend up">‚Üë 20% ce mois</span>
        </div>
      </div>

      <div class="main-stat-card rating">
        <div class="stat-icon">‚≠ê</div>
        <div class="stat-content">
          <h3>{{ getAverageRating() }}/5</h3>
          <p>Note moyenne</p>
          <span class="trend up">‚Üë 0.3 ce mois</span>
        </div>
      </div>

      <div class="main-stat-card completion">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-content">
          <h3>{{ getCompletionRate() }}%</h3>
          <p>Taux de compl√©tion</p>
          <span class="trend down">‚Üì 2% ce mois</span>
        </div>
      </div>
    </div>

    <!-- Barre de filtres -->
    <div class="filters-section">
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (ngModelChange)="applyFilters()"
          placeholder="Rechercher une commande, produit ou client..."
          class="search-input"
        />
      </div>

      <div class="filter-controls">
        <div class="filter-group">
          <label>P√©riode:</label>
          <select
            [(ngModel)]="selectedPeriod"
            (ngModelChange)="applyFilters()"
            title="periode"
          >
            <option *ngFor="let period of periods" [value]="period.id">
              {{ period.name }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label>Statut:</label>
          <select
            [(ngModel)]="selectedStatus"
            (ngModelChange)="applyFilters()"
            title="statut"
          >
            <option *ngFor="let status of statuses" [value]="status.id">
              {{ status.name }}
            </option>
          </select>
        </div>

        <div class="filter-group">
          <label>Paiement:</label>
          <select
            [(ngModel)]="selectedPayment"
            (ngModelChange)="applyFilters()"
            title="paie"
          >
            <option *ngFor="let method of paymentMethods" [value]="method.id">
              {{ method.name }}
            </option>
          </select>
        </div>

        <button class="clear-filters" (click)="clearFilters()">
          ‚úï Effacer filtres
        </button>
      </div>
    </div>

    <!-- Statistiques d√©taill√©es -->
    <div class="detailed-stats">
      <h2 class="section-title">üìä Statistiques d√©taill√©es</h2>

      <div class="stats-grid">
        <div *ngFor="let stat of stats" class="stat-card">
          <div class="stat-header">
            <div
              class="stat-icon-box"
              [style.backgroundColor]="stat.color + '20'"
            >
              {{ stat.icon }}
            </div>
            <div
              class="trend-indicator"
              [class.up]="stat.trend === 'up'"
              [class.down]="stat.trend === 'down'"
            >
              {{ stat.trend === 'up' ? '‚Üë' : '‚Üì' }} {{ stat.change }}%
            </div>
          </div>
          <div class="stat-value">{{ stat.value.toLocaleString() }}</div>
          <div class="stat-label">{{ stat.label }}</div>
        </div>
      </div>
    </div>

    <!-- Graphiques -->
    <div class="charts-section">
      <div class="chart-card">
        <h3>üìà √âvolution des revenus</h3>
        <div class="chart-placeholder">
          <p>Graphique des revenus (FCFA)</p>
          <div class="chart-bars">
            <div *ngFor="let month of monthlyStats" class="chart-bar">
              <div class="bar-label">{{ month.month }}</div>
              <div class="bar-container">
                <div
                  class="bar-fill"
                  [style.height]="(month.revenue / 1000000 * 100) + '%'"
                  [style.backgroundColor]="'#2e7d32'"
                ></div>
              </div>
              <div class="bar-value">
                {{ (month.revenue / 1000).toFixed(0) }}K
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-card">
        <h3>üìä Top produits</h3>
        <div class="top-products">
          <div
            *ngFor="let product of topProducts; let i = index"
            class="product-row"
          >
            <div class="product-rank">#{{ i + 1 }}</div>
            <div class="product-name">{{ product.name }}</div>
            <div class="product-sales">{{ product.sales }} ventes</div>
            <div class="product-revenue">
              {{ product.revenue.toLocaleString() }} FCFA
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Liste des ventes -->
    <div class="sales-section">
      <div class="section-header">
        <h2>Historique des commandes ({{ filteredSales.length }})</h2>
        <div class="summary">
          <span class="summary-value">
            {{ getTotalFilteredRevenue() }} FCFA
          </span>

          <span class="summary-item">
            <span class="summary-label">Commandes:</span>
            <span class="summary-value">{{ filteredSales.length }}</span>
          </span>
        </div>
      </div>

      <div *ngIf="isLoading" class="loading">
        <div class="spinner"></div>
        <p>Chargement des ventes...</p>
      </div>

      <div *ngIf="!isLoading && filteredSales.length === 0" class="empty-state">
        <div class="empty-icon">üí∞</div>
        <h3>Aucune vente trouv√©e</h3>
        <p>Aucune vente ne correspond √† vos crit√®res de recherche.</p>
      </div>

      <div class="sales-list">
        <div *ngFor="let sale of filteredSales" class="sale-card">
          <div class="sale-header">
            <div class="sale-info">
              <div class="sale-number">{{ sale.orderNumber }}</div>
              <div class="sale-date">
                {{ sale.date | date:'dd/MM/yyyy HH:mm' }}
              </div>
            </div>
            <div class="sale-status">
              <span [class]="'status-badge ' + getStatusClass(sale.status)">
                {{ getStatusText(sale.status) }}
              </span>
            </div>
          </div>

          <div class="sale-body">
            <div class="sale-product">
              <div class="product-name">{{ sale.product }}</div>
              <div class="product-quantity">√ó {{ sale.quantity }}</div>
            </div>

            <div class="sale-details">
              <div class="detail-group">
                <span class="detail-label">Client:</span>
                <span class="detail-value">{{ sale.buyer.name }}</span>
              </div>
              <div class="detail-group">
                <span class="detail-label">T√©l√©phone:</span>
                <span class="detail-value">{{ sale.buyer.phone }}</span>
              </div>
              <div class="detail-group">
                <span class="detail-label">Livraison:</span>
                <span class="detail-value"
                  >{{ getDeliveryTypeText(sale.deliveryType) }}</span
                >
              </div>
              <div class="detail-group">
                <span class="detail-label">Paiement:</span>
                <span class="detail-value"
                  >{{ getPaymentMethodText(sale.paymentMethod) }}</span
                >
              </div>
            </div>

            <div class="sale-amount">
              <div class="unit-price">
                {{ sale.unitPrice.toLocaleString() }} FCFA/u
              </div>
              <div class="total-amount">
                {{ sale.totalAmount.toLocaleString() }} FCFA
              </div>
            </div>
          </div>

          <div class="sale-footer">
            <div class="sale-actions">
              <button class="action-btn view" (click)="viewSaleDetails(sale)">
                üëÅÔ∏è D√©tails
              </button>

              <div
                class="status-actions"
                *ngIf="sale.status !== 'completed' && sale.status !== 'cancelled'"
              >
                <select
                  (change)="updateSaleStatus(sale.id, $any($event.target).value)"
                  class="status-select"
                  title="statut"
                >
                  <option value="">Changer statut</option>
                  <option value="completed">Marquer comme compl√©t√©</option>
                  <option value="shipped">Marquer comme exp√©di√©</option>
                  <option value="cancelled">Annuler la commande</option>
                </select>
              </div>
            </div>

            <div class="sale-rating" *ngIf="sale.rating">
              <div class="stars">
                <span
                  *ngFor="let star of [1,2,3,4,5]"
                  class="star"
                  [class.filled]="star <= sale.rating"
                  >‚òÖ</span
                >
              </div>
              <div class="review" *ngIf="sale.review">"{{ sale.review }}"</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <button class="page-btn prev" disabled>‚Üê Pr√©c√©dent</button>
        <div class="page-numbers">
          <span class="page-number active">1</span>
          <span class="page-number">2</span>
          <span class="page-number">3</span>
        </div>
        <button class="page-btn next">Suivant ‚Üí</button>
      </div>
    </div>

    <!-- Insights -->
    <div class="insights-section">
      <div class="insight-card">
        <h3>üí° Insights</h3>
        <ul>
          <li>Vos Tomates Bio sont votre produit le plus populaire</li>
          <li>
            Les paiements par Orange Money repr√©sentent 60% de vos transactions
          </li>
          <li>La livraison est 2x plus populaire que le retrait sur place</li>
          <li>Vos meilleurs clients viennent de Dakar Plateau</li>
        </ul>
      </div>
      <div class="insight-card">
        <h3>üéØ Recommandations</h3>
        <ul>
          <li>Augmentez votre stock de Tomates Bio</li>
          <li>Proposez des promotions sur les Carottes</li>
          <li>Activez plus de certifications pour augmenter les prix</li>
          <li>Am√©liorez vos d√©lais de livraison pour augmenter les notes</li>
        </ul>
      </div>
    </div>
  </main>


</div>
