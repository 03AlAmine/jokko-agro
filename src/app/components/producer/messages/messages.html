<div class="messages-container">
  <main class="main-content">
    <div class="messages-layout">
      <!-- Panel des conversations -->
      <div class="conversations-panel">
        <div class="panel-header">
          <h2>ğŸ“¨ Messages clients</h2>
          <div class="header-stats">
            <span class="stat">
              <span class="stat-icon">ğŸ’¬</span>
              {{ getActiveConversationsCount() }} conversations
            </span>
            <span *ngIf="getUnreadCount() > 0" class="stat unread">
              <span class="stat-icon">ğŸ””</span>
              {{ getUnreadCount() }} non lus
            </span>
          </div>
        </div>

        <!-- Barre de recherche -->
        <div class="search-box">
          <span class="search-icon">ğŸ”</span>
          <input
            type="text"
            [(ngModel)]="searchQuery"
            placeholder="Rechercher un client..."
            class="search-input"
          >
        </div>

        <!-- Liste des conversations -->
        <div class="conversations-list">
          <div *ngFor="let conversation of conversations"
               class="conversation-item"
               [class.active]="selectedConversation?.id === conversation.id"
               [class.unread]="conversation.unreadCount > 0"
               (click)="selectConversation(conversation)">

            <div class="conversation-avatar">
              {{ conversation.buyerAvatar }}
              <span *ngIf="conversation.unreadCount > 0" class="unread-dot"></span>
            </div>

            <div class="conversation-content">
              <div class="conversation-header">
                <div class="conversation-name">{{ conversation.buyerName }}</div>
                <div class="conversation-time">{{ getConversationTime(conversation) }}</div>
              </div>

              <div class="conversation-preview">
                <div class="preview-text" [class.unread]="conversation.unreadCount > 0">
                  {{ conversation.lastMessage }}
                </div>
                <div class="conversation-meta">
                  <span *ngIf="conversation.productName" class="product-tag">
                    {{ conversation.productName }}
                  </span>
                  <span *ngIf="conversation.unreadCount > 0" class="unread-badge">
                    {{ conversation.unreadCount }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="conversations.length === 0 && !isLoading" class="empty-conversations">
            <div class="empty-icon">ğŸ’¬</div>
            <h3>Aucun message</h3>
            <p>Vous n'avez pas encore de conversations avec des clients</p>
          </div>

          <div *ngIf="isLoading" class="loading-conversations">
            <div class="spinner"></div>
            <p>Chargement des conversations...</p>
          </div>
        </div>
      </div>

      <!-- Panel de discussion -->
      <div class="chat-panel" *ngIf="selectedConversation; else selectConversationPrompt">
        <!-- En-tÃªte de la discussion -->
        <div class="chat-header">
          <div class="chat-user">
            <div class="user-avatar">{{ selectedConversation.buyerAvatar }}</div>
            <div class="user-info">
              <h3>{{ selectedConversation.buyerName }}</h3>
              <p *ngIf="selectedConversation.productName">
                Ã€ propos de : {{ selectedConversation.productName }}
              </p>
            </div>
          </div>

          <div class="chat-actions">
            <button class="chat-action-btn"
                    (click)="archiveConversation(selectedConversation.id!)"
                    title="Archiver">
              ğŸ“
            </button>
          </div>
        </div>

        <!-- Messages -->
        <div class="messages-container-sms">
          <div class="messages-list">
            <div *ngFor="let message of messages"
                 class="message-wrapper"
                 [class.sent]="message.senderRole === 'producer'"
                 [class.received]="message.senderRole === 'buyer'">

              <div class="message">
                <div class="message-sender" *ngIf="message.senderRole === 'buyer'">
                  {{ message.senderName }}
                </div>
                <div class="message-content">
                  {{ message.content }}
                </div>
                <div class="message-time">
                  {{ getMessageTime(message) }}
                  <span *ngIf="message.senderRole === 'producer'" class="message-status">
                    {{ message.read ? 'âœ“âœ“' : 'âœ“' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Champ de saisie -->
        <div class="message-input-area">
          <div class="input-wrapper">
            <input
              type="text"
              [(ngModel)]="newMessage"
              (keyup.enter)="sendMessage()"
              placeholder="RÃ©pondre Ã  {{ selectedConversation.buyerName }}..."
              class="message-input"
            >
            <button class="send-btn"
                    (click)="sendMessage()"
                    [disabled]="!newMessage.trim()">
              <span class="send-icon">ğŸ“¤</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Message de sÃ©lection -->
      <ng-template #selectConversationPrompt>
        <div class="select-conversation-prompt">
          <div class="prompt-icon">ğŸ’¬</div>
          <h2>SÃ©lectionnez une conversation</h2>
          <p>Choisissez une conversation avec un client pour commencer Ã  discuter</p>

          <div class="prompt-tips">
            <h4>ğŸ’¡ Conseils pour une bonne communication :</h4>
            <ul>
              <li><strong>RapiditÃ© :</strong> RÃ©pondez dans les 24 heures maximum</li>
              <li><strong>ClartÃ© :</strong> Soyez prÃ©cis sur les prix et disponibilitÃ©s</li>
              <li><strong>Professionalisme :</strong> Utilisez un langage poli et courtois</li>
              <li><strong>Transparence :</strong> Informez des dÃ©lais de livraison rÃ©els</li>
            </ul>
          </div>
        </div>
      </ng-template>
    </div>
  </main>
</div>
