<div class="add-product-container">
  <!-- Navigation horizontale -->
  <header class="top-navigation">
    <div class="nav-header">
      <div class="header-left">
        <a routerLink="/producer/products" class="back-btn">
          <i class="back-icon">‚Üê</i>
          Retour
        </a>
        <div class="page-title">
          <h1>Nouveau Produit</h1>
          <p>Ajoutez un nouveau produit √† votre catalogue</p>
        </div>
      </div>

      <div class="progress-section">
        <div class="progress-info">
          <span class="progress-percent">{{ completionPercentage }}%</span>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="completionPercentage"></div>
          </div>
        </div>
        <div class="header-actions">
          <button class="action-btn secondary" (click)="saveAsDraft()">
            <span class="btn-icon">üíæ</span>
            Brouillon
          </button>
          <button class="action-btn primary"
                  [disabled]="productForm.invalid || isSubmitting"
                  (click)="submitForm()">
            <span *ngIf="!isSubmitting" class="btn-icon">üöÄ</span>
            <span *ngIf="isSubmitting" class="spinner"></span>
            {{ isSubmitting ? 'Publication...' : 'Publier' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Navigation des √©tapes -->
    <nav class="steps-navigation">
      <div class="steps-container">
        <div *ngFor="let section of sections"
             class="step-item"
             [class.active]="currentSection === section.id"
             [class.completed]="isSectionCompleted(section.id)"
             (click)="goToSection(section.id)">
          <div class="step-number">{{ section.number }}</div>
          <div class="step-info">
            <div class="step-title">{{ section.title }}</div>
            <div class="step-desc">{{ section.description }}</div>
          </div>
          <div class="step-status">
            <span *ngIf="isSectionCompleted(section.id)" class="status-icon">‚úì</span>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- Contenu principal -->
  <main class="main-content">
    <div class="content-wrapper">
      <!-- Section 1: Informations de base -->
      <section id="basic-info" class="form-section" [class.active]="currentSection === 'basic-info'">
        <div class="section-content">
          <div class="section-header">
            <h2 class="section-title">Informations de base</h2>
            <p class="section-description">Les informations essentielles pour identifier votre produit</p>
          </div>

          <div class="form-row">
            <div class="form-field">
              <label for="name" class="field-label">
                Nom du produit <span class="required">*</span>
              </label>
              <input type="text"
                     id="name"
                     formControlName="name"
                     placeholder="Ex: Tomates bio fra√Æches du march√©"
                     class="form-input"
                     [class.error]="showFieldError('name')">
              <div class="field-hint">Donnez un nom clair et attractif</div>
              <div class="error-message" *ngIf="showFieldError('name')">
                <i class="error-icon">‚ö†Ô∏è</i> Nom requis (3-100 caract√®res)
              </div>
            </div>

            <div class="form-field">
              <label for="category" class="field-label">
                Cat√©gorie <span class="required">*</span>
              </label>
              <div class="category-select">
                <select id="category"
                        formControlName="category"
                        class="form-select"
                        [class.error]="showFieldError('category')">
                  <option value="" disabled selected>Choisir une cat√©gorie</option>
                  <option *ngFor="let cat of categories" [value]="cat.id">
                    {{ cat.icon }} {{ cat.name }}
                  </option>
                </select>
                <i class="select-arrow">‚ñº</i>
              </div>
              <div class="error-message" *ngIf="showFieldError('category')">
                <i class="error-icon">‚ö†Ô∏è</i> S√©lectionnez une cat√©gorie
              </div>
            </div>
          </div>

          <div class="form-field">
            <label for="description" class="field-label">
              Description <span class="required">*</span>
            </label>
            <div class="rich-text-container">
              <textarea id="description"
                        formControlName="description"
                        rows="5"
                        placeholder="D√©crivez votre produit en d√©tail..."
                        class="rich-textarea"
                        [class.error]="showFieldError('description')"
                        (input)="updateDescriptionLength($event)">
              </textarea>
              <div class="textarea-tools">
                <div class="text-actions">
                  <button type="button" class="text-tool" title="Gras"><b>B</b></button>
                  <button type="button" class="text-tool" title="Italique"><i>I</i></button>
                  <button type="button" class="text-tool" title="Liste">‚Ä¢</button>
                </div>
                <div class="char-counter">
                  {{ descriptionLength }}/500 caract√®res
                </div>
              </div>
            </div>
            <div class="description-tips">
              <i class="tip-icon">üí°</i>
              <span>Conseil : Mentionnez la fra√Æcheur, la qualit√© et les avantages</span>
            </div>
            <div class="error-message" *ngIf="showFieldError('description')">
              <i class="error-icon">‚ö†Ô∏è</i> Description requise (10-500 caract√®res)
            </div>
          </div>
        </div>
      </section>

      <!-- Section 2: Prix & Quantit√© -->
      <section id="price-quantity" class="form-section" [class.active]="currentSection === 'price-quantity'">
        <div class="section-content">
          <div class="section-header">
            <h2 class="section-title">Prix & Quantit√©</h2>
            <p class="section-description">D√©finissez le prix et les quantit√©s disponibles</p>
          </div>

          <div class="price-grid">
            <div class="form-field">
              <label for="price" class="field-label">
                Prix unitaire <span class="required">*</span>
              </label>
              <div class="price-input-group">
                <input type="number"
                       id="price"
                       formControlName="price"
                       min="100"
                       step="50"
                       placeholder="1500"
                       class="price-input"
                       [class.error]="showFieldError('price')"
                       (input)="updateEstimatedTotal()">
                <span class="currency">FCFA</span>
              </div>
              <div class="field-hint">Prix minimum: 100 FCFA</div>
              <div class="error-message" *ngIf="showFieldError('price')">
                <i class="error-icon">‚ö†Ô∏è</i> Prix invalide (100-1,000,000 FCFA)
              </div>
            </div>

            <div class="form-field">
              <label for="quantity" class="field-label">
                Quantit√© disponible <span class="required">*</span>
              </label>
              <input type="number"
                     id="quantity"
                     formControlName="quantity"
                     min="1"
                     placeholder="50"
                     class="form-input"
                     [class.error]="showFieldError('quantity')"
                     (input)="updateEstimatedTotal()">
              <div class="error-message" *ngIf="showFieldError('quantity')">
                <i class="error-icon">‚ö†Ô∏è</i> Quantit√© minimum: 1
              </div>
            </div>

            <div class="form-field">
              <label for="unit" class="field-label">
                Unit√© de mesure <span class="required">*</span>
              </label>
              <div class="unit-select">
                <select id="unit"
                        formControlName="unit"
                        class="form-select">
                  <option *ngFor="let unit of units" [value]="unit.id">
                    {{ unit.symbol }} ({{ unit.name }})
                  </option>
                </select>
                <i class="select-arrow">‚ñº</i>
              </div>
            </div>
          </div>

          <!-- Calcul total -->
          <div class="total-estimation" *ngIf="estimatedTotal > 0">
            <div class="estimation-card">
              <div class="estimation-icon">üí∞</div>
              <div class="estimation-details">
                <div class="estimation-title">Valeur totale estim√©e</div>
                <div class="estimation-price">
                  {{ estimatedTotal.toLocaleString('fr-FR') }} FCFA
                </div>
                <div class="estimation-breakdown">
                  {{ productForm.get('price')?.value || 0 }} FCFA √ó
                  {{ productForm.get('quantity')?.value || 0 }} unit√©s
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Section 3: Images -->
      <section id="images" class="form-section" [class.active]="currentSection === 'images'">
        <div class="section-content">
          <div class="section-header">
            <h2 class="section-title">Images du produit</h2>
            <p class="section-description">Ajoutez des photos attractives pour mieux vendre</p>
          </div>

          <div class="image-upload-zone">
            <!-- Upload principal -->
            <div class="main-upload" (click)="triggerImageUpload()" [class.has-image]="mainImagePreview">
              <input type="file"
                     id="mainImageUpload"
                     accept="image/*"
                     (change)="onMainImageSelected($event)"
                     class="hidden-input">

              <div *ngIf="!mainImagePreview" class="upload-placeholder">
                <div class="upload-icon-large">
                  <svg width="64" height="64" viewBox="0 0 24 24">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                  </svg>
                </div>
                <div class="upload-text">
                  <h4>Photo principale</h4>
                  <p>Cliquez pour ajouter la photo de couverture</p>
                  <div class="upload-hint">
                    <span class="hint-tag">Recommand√©</span>
                    <span class="hint-tag">5MB max</span>
                  </div>
                </div>
              </div>

              <div *ngIf="mainImagePreview" class="image-preview-main">
                <img [src]="mainImagePreview" alt="Image principale">
                <div class="image-overlay">
                  <button type="button" class="image-btn change" (click)="triggerImageUpload()">
                    <i>üîÑ</i> Changer
                  </button>
                  <button type="button" class="image-btn remove" (click)="removeMainImage()">
                    <i>üóëÔ∏è</i> Supprimer
                  </button>
                </div>
              </div>
            </div>

            <!-- Images additionnelles -->
            <div class="additional-images-section">
              <h4 class="sub-section-title">Photos additionnelles</h4>
              <p class="sub-section-desc">Ajoutez jusqu'√† 4 photos suppl√©mentaires</p>

              <div class="additional-images-grid">
                <div *ngFor="let img of additionalImages; let i = index" class="additional-image-item">
                  <img [src]="img.preview" [alt]="'Image ' + (i + 1)">
                  <button class="remove-additional" (click)="removeAdditionalImage(i)">√ó</button>
                </div>

                <div *ngIf="additionalImages.length < 4"
                     class="add-more-item"
                     (click)="triggerAdditionalUpload()">
                  <div class="add-icon">+</div>
                  <span>Ajouter une photo</span>
                </div>
              </div>
            </div>

            <input type="file"
                   id="additionalImagesUpload"
                   accept="image/*"
                   multiple
                   (change)="onAdditionalImagesSelected($event)"
                   class="hidden-input">
          </div>

          <!-- Conseils images -->
          <div class="image-tips-card">
            <div class="tips-header">
              <i class="tips-icon">üì∏</i>
              <h4>Conseils pour de belles photos</h4>
            </div>
            <ul class="tips-list">
              <li>Utilisez la lumi√®re du jour</li>
              <li>Prenez des photos sous diff√©rents angles</li>
              <li>Montrez le produit en situation r√©elle</li>
              <li>√âvitez les arri√®re-plans charg√©s</li>
              <li>Assurez-vous que la photo soit nette</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Section 4: Certifications -->
      <section id="certifications" class="form-section" [class.active]="currentSection === 'certifications'">
        <div class="section-content">
          <div class="section-header">
            <h2 class="section-title">Certifications & Qualit√©s</h2>
            <p class="section-description">Mettez en valeur les qualit√©s de votre produit</p>
          </div>

          <div class="certifications-selector">
            <h4 class="selector-title">S√©lectionnez les certifications applicables</h4>

            <div class="certifications-grid">
              <div *ngFor="let cert of certifications"
                   class="certification-card"
                   [class.selected]="isCertificationSelected(cert.id)"
                   (click)="toggleCertification(cert.id)">
                <div class="cert-icon">{{ cert.icon }}</div>
                <div class="cert-content">
                  <h5>{{ cert.name }}</h5>
                  <p>{{ cert.description }}</p>
                </div>
                <div class="cert-checkbox">
                  <div class="checkbox" [class.checked]="isCertificationSelected(cert.id)"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Option Bio -->
          <div class="organic-option">
            <label class="option-toggle">
              <input type="checkbox" formControlName="isOrganic">
              <div class="toggle-slider">
                <span class="toggle-icon">üå±</span>
                <span class="toggle-label">Produit issu de l'agriculture biologique</span>
              </div>
              <span class="toggle-badge">Certifi√©</span>
            </label>
          </div>
        </div>
      </section>

      <!-- Section 5: D√©tails suppl√©mentaires -->
      <section id="additional-details" class="form-section" [class.active]="currentSection === 'additional-details'">
        <div class="section-content">
          <div class="section-header">
            <h2 class="section-title">D√©tails suppl√©mentaires</h2>
            <p class="section-description">Informations compl√©mentaires pour les acheteurs</p>
          </div>

          <div class="details-grid">
            <div class="form-field">
              <label for="harvestDate" class="field-label">Date de r√©colte</label>
              <div class="date-picker">
                <input type="date"
                       id="harvestDate"
                       formControlName="harvestDate"
                       class="form-input">
                <i class="date-icon">üìÖ</i>
              </div>
            </div>

            <div class="form-field">
              <label for="expirationDate" class="field-label">Date d'expiration</label>
              <div class="date-picker">
                <input type="date"
                       id="expirationDate"
                       formControlName="expirationDate"
                       class="form-input">
                <i class="date-icon">‚è≥</i>
              </div>
            </div>
          </div>

          <div class="form-field">
            <label for="storageConditions" class="field-label">Conditions de conservation</label>
            <input type="text"
                   id="storageConditions"
                   formControlName="storageConditions"
                   placeholder="Ex: Conserver au frais entre 2¬∞C et 8¬∞C"
                   class="form-input">
          </div>

          <div class="details-grid">
            <div class="form-field">
              <label for="location" class="field-label">Lieu de production</label>
              <div class="location-input">
                <i class="location-icon">üìç</i>
                <input type="text"
                       id="location"
                       formControlName="location"
                       placeholder="Ex: R√©gion de Thi√®s, S√©n√©gal"
                       class="form-input">
              </div>
            </div>

            <div class="form-field">
              <label for="contactPhone" class="field-label">Contact t√©l√©phonique</label>
              <div class="phone-input">
                <span class="phone-prefix">+221</span>
                <input type="tel"
                       id="contactPhone"
                       formControlName="contactPhone"
                       placeholder="77 123 45 67"
                       class="form-input">
              </div>
            </div>
          </div>

          <div class="form-field">
            <label for="minOrderQuantity" class="field-label">
              <i class="field-icon">üì¶</i>
              Quantit√© minimale de commande
            </label>
            <div class="min-order-input">
              <input type="number"
                     id="minOrderQuantity"
                     formControlName="minOrderQuantity"
                     min="1"
                     placeholder="1"
                     class="form-input">
              <span class="order-unit">unit√©s</span>
            </div>
            <div class="field-hint">
              Les acheteurs devront commander au moins cette quantit√©
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Navigation en bas -->
  <footer class="bottom-navigation">
    <div class="nav-controls">
      <button class="nav-btn prev" (click)="goToPreviousSection()" [disabled]="isFirstSection()">
        <i class="nav-icon">‚Üê</i>
        Pr√©c√©dent
      </button>

      <div class="nav-dots">
        <span *ngFor="let section of sections"
              class="nav-dot"
              [class.active]="currentSection === section.id"
              [class.completed]="isSectionCompleted(section.id)"
              (click)="goToSection(section.id)">
        </span>
      </div>

      <button class="nav-btn next" (click)="goToNextSection()" [disabled]="isLastSection()">
        Suivant
        <i class="nav-icon">‚Üí</i>
      </button>
    </div>
  </footer>
</div>
