<div class="cart-container">
  <!-- En-t√™te am√©lior√© avec statistiques -->
  <div class="cart-header">
    <div class="header-left">
      <h1><span class="header-icon">üõí</span> Mon Panier</h1>
      <p class="subtitle">V√©rifiez vos articles et passez √† la caisse</p>
      <div class="cart-stats" *ngIf="cartItems.length > 0">
        <span class="stat-item">üì¶ {{cartItems.length}} article(s)</span>
        <span class="stat-item">üí∞ {{formatPrice(getSubtotal())}}</span>
        <span class="stat-item"
          >üöö {{getSelectedItemsCount()}} s√©lectionn√©(s)</span
        >
      </div>
    </div>
    <div class="header-right">
      <button
        class="secondary-btn"
        (click)="saveCartForLater()"
        title="Sauvegarder le panier"
      >
        üíæ Sauvegarder
      </button>
      <button class="continue-btn" (click)="continueShopping()">
        ‚Üê Continuer mes achats
      </button>
      <!-- AJOUTEZ CE BOUTON -->
      <button class="action-btn" (click)="goToOrders()">
        üì¶ Voir mes commandes
      </button>
    </div>
  </div>

  <div
    *ngFor="let notification of notifications"
    class="notification {{notification.type}}"
    [class.removing]="notification.removing"
  >
    <span class="notification-icon">
      {{notification.type === 'success' ? '‚úÖ' : notification.type === 'error' ?
      '‚ùå' : notification.type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}}
    </span>
    <span class="notification-content">{{notification.message}}</span>
    <button
      class="notification-close"
      (click)="removeNotification(notification.id)"
    >
      √ó
    </button>
  </div>
  <!-- Message panier vide am√©lior√© -->
  <div *ngIf="cartItems.length === 0" class="empty-cart">
    <div class="empty-icon">üõí</div>
    <h2>Votre panier est vide</h2>
    <p>Ajoutez des produits frais depuis le march√©</p>

    <!-- Panier sauvegard√© -->
    <div
      *ngIf="savedCart && savedCart.items.length > 0"
      class="saved-cart-section"
    >
      <h4>üìã Panier sauvegard√©</h4>
      <div class="saved-items">
        <div *ngFor="let item of savedCart.items" class="saved-item">
          <span>{{item.name}} √ó {{item.quantity}}</span>
          <button class="btn-small" (click)="restoreSavedItem(item.id)">
            Restaurer
          </button>
        </div>
      </div>
      <button class="btn-secondary" (click)="restoreAllSavedItems()">
        üîÑ Restaurer tout le panier
      </button>
    </div>

    <button class="btn-primary" routerLink="/buyer/market">
      üõçÔ∏è D√©couvrir le march√©
    </button>
  </div>

  <!-- Contenu du panier -->
  <div *ngIf="cartItems.length > 0" class="cart-content">
    <!-- Barre d'actions rapides -->
    <div class="quick-actions">
      <button class="action-btn" (click)="clearCart()">
        üóëÔ∏è Vider le panier
      </button>
      <button class="action-btn" (click)="shareCart()">
        üì§ Partager le panier
      </button>
      <button class="action-btn" (click)="saveCartForLater()">
        üíæ Sauvegarder pour plus tard
      </button>
    </div>

    <div class="cart-layout">
      <!-- Section gauche : Articles am√©lior√©e -->
      <div class="cart-items-section">
        <!-- En-t√™te des articles -->
        <div class="items-header">
          <div class="select-all">
            <label class="checkbox-label">
              <input
                type="checkbox"
                [checked]="areAllItemsSelected()"
                (change)="selectAllItems()"
              />
              <span class="checkbox-custom"></span>
              <span class="checkbox-text"
                >Tout s√©lectionner ({{ getSelectedItemsCount() }})</span
              >
            </label>
          </div>
          <div class="header-actions">
            <span class="items-count">
              {{ cartItems.length }} article{{ cartItems.length > 1 ? 's' : ''
              }} ‚Ä¢ Total: {{ formatPrice(getSubtotal()) }}
            </span>
            <button class="btn-sort" (click)="toggleSort()">
              üîÑ Trier par: {{sortBy === 'name' ? 'Nom' : 'Prix'}}
            </button>
          </div>
        </div>

        <!-- Liste des articles avec tri -->
        <div class="items-list">
          <div
            *ngFor="let item of getSortedItems()"
            class="cart-item"
            [class.low-stock]="item.quantity > item.maxQuantity * 0.8"
          >
            <div class="item-select">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [checked]="item.selected"
                  (change)="toggleSelectItem(item.id)"
                  title="S√©lectionner l'article"
                />
                <span class="checkbox-custom"></span>
              </label>
            </div>

            <!-- Image avec overlay d'informations -->
            <div class="item-image-container">
              <div class="item-image">
                <img
                  *ngIf="isImageUrl(item.imageUrl)"
                  [src]="item.imageUrl"
                  [alt]="item.name"
                  (error)="handleImageError($event)"
                />

                <!-- CAS 2 : emoji -->
                <span *ngIf="!isImageUrl(item.imageUrl)" class="emoji-image">
                  {{ item.imageUrl || 'üõçÔ∏è' }}
                </span>
                <span
                  *ngIf="item.certified"
                  class="certified-badge"
                  title="Produit certifi√©"
                  >‚úî</span
                >
              </div>
              <div class="image-overlay" *ngIf="item.discount">
                <span class="discount-badge">-{{item.discount}}%</span>
              </div>
            </div>

            <div class="item-details">
              <div class="item-header">
                <div>
                  <h3 class="item-name">{{ item.name }}</h3>
                  <div class="item-category">{{item.category}}</div>
                </div>
                <div class="item-actions">
                  <button
                    class="remove-btn"
                    (click)="removeItem(item.id)"
                    title="Retirer"
                  >
                    ‚úï
                  </button>
                  <button
                    class="save-btn"
                    (click)="saveItemForLater(item.id)"
                    title="Sauvegarder pour plus tard"
                  >
                    üíæ
                  </button>
                </div>
              </div>

              <div class="item-producer">
                üë®‚Äçüåæ Producteur: {{ item.producer }}
                <span class="producer-rating" *ngIf="item.producerRating">
                  ‚≠ê {{item.producerRating}}
                </span>
              </div>

              <div class="item-badges">
                <span *ngIf="item.certified" class="badge certified"
                  >Certifi√©</span
                >
                <span *ngIf="item.organic" class="badge organic">Bio</span>
                <span *ngIf="item.local" class="badge local">Local</span>
                <span *ngIf="item.seasonal" class="badge seasonal"
                  >De saison</span
                >
                <span class="badge delivery">
                  {{ item.deliveryType === 'pickup' ? 'üõµ √Ä retirer' : 'üöö
                  Livraison' }}
                </span>
              </div>

              <!-- Notes avec suggestions -->
              <div class="item-notes">
                <div
                  class="notes-suggestions"
                  *ngIf="noteSuggestions.length > 0"
                >
                  <span class="suggestions-label">Suggestions:</span>
                  <button
                    *ngFor="let suggestion of noteSuggestions"
                    class="suggestion-btn"
                    (click)="applyNoteSuggestion(item.id, suggestion)"
                  >
                    {{suggestion}}
                  </button>
                </div>
                <input
                  type="text"
                  [(ngModel)]="item.notes"
                  (input)="updateItemNotes(item.id, $any($event.target).value)"
                  placeholder="Ajouter une note pour le producteur..."
                  class="notes-input"
                  [class.has-note]="item.notes"
                />
              </div>
            </div>

            <!-- Quantit√© am√©lior√©e -->
            <div class="item-quantity">
              <div class="quantity-controls">
                <button
                  class="qty-btn"
                  (click)="updateQuantity(item.id, -1)"
                  [disabled]="item.quantity <= 1"
                  title="R√©duire"
                >
                  ‚àí
                </button>
                <input
                  type="number"
                  [(ngModel)]="item.quantity"
                  (change)="validateQuantity(item)"
                  min="1"
                  [max]="item.maxQuantity"
                  class="qty-input"
                  title="Quantit√©"
                />
                <button
                  class="qty-btn"
                  (click)="updateQuantity(item.id, 1)"
                  [disabled]="item.quantity >= item.maxQuantity"
                  title="Augmenter"
                >
                  +
                </button>
              </div>
              <div class="qty-info">
                <div class="qty-max">Max: {{ item.maxQuantity }}</div>
                <div
                  *ngIf="item.quantity > item.maxQuantity * 0.8"
                  class="qty-warning"
                >
                  ‚ö†Ô∏è Stock limit√©
                </div>
              </div>
            </div>

            <!-- Prix am√©lior√© -->
            <div class="item-price">
              <div class="price-original" *ngIf="item.originalPrice">
                {{ formatPrice(item.originalPrice * item.quantity) }}
              </div>
              <div class="price-main">
                {{ formatPrice(calculateItemPrice(item)) }}
                <span *ngIf="item.originalPrice" class="price-savings">
                  (√âconomisez {{ formatPrice(calculateSavings(item)) }})
                </span>
              </div>
              <div class="price-unit">
                {{ formatPrice(getUnitPrice(item)) }} / {{ item.unit }}
              </div>
              <div *ngIf="getItemDeliveryFee(item) > 0" class="price-delivery">
                + {{ formatPrice(getItemDeliveryFee(item)) }} livraison
              </div>
              <div *ngIf="item.bulkDiscount" class="bulk-discount">
                üè∑Ô∏è R√©duction volume: {{item.bulkDiscount}}%
              </div>
            </div>
          </div>
        </div>

        <!-- Estimation d'√©conomies -->
        <div class="savings-estimation" *ngIf="getTotalSavings() > 0">
          <div class="savings-icon">üí∞</div>
          <div class="savings-content">
            <strong
              >Vous √©conomisez {{ formatPrice(getTotalSavings()) }} !</strong
            >
            <span>Gr√¢ce aux promotions et r√©ductions</span>
          </div>
        </div>
      </div>

      <!-- Section droite : R√©capitulatif am√©lior√© -->
      <div class="cart-summary-section">
        <!-- R√©capitulatif de commande -->
        <div class="summary-card">
          <h3>üìã R√©capitulatif de commande</h3>

          <div class="summary-details">
            <div class="summary-row">
              <span>Sous-total</span>
              <span>{{ formatPrice(getSubtotal()) }}</span>
            </div>

            <!-- D√©tails des √©conomies -->
            <div *ngIf="getTotalSavings() > 0" class="summary-row savings">
              <span>√âconomies r√©alis√©es</span>
              <span class="savings-amount"
                >-{{ formatPrice(getTotalSavings()) }}</span
              >
            </div>

            <div class="summary-row">
              <span>Frais de livraison</span>
              <span>
                {{ formatPrice(getDeliveryFee()) }}
                <span
                  class="fee-details"
                  (click)="showDeliveryDetails = !showDeliveryDetails"
                >
                  ‚ÑπÔ∏è
                </span>
              </span>
            </div>

            <div *ngIf="showDeliveryDetails" class="delivery-breakdown">
              <div
                *ngFor="let item of getDeliveryBreakdown()"
                class="breakdown-item"
              >
                <span>{{item.name}}</span>
                <span>{{formatPrice(item.fee)}}</span>
              </div>
            </div>

            <div class="summary-row">
              <span>Frais de paiement</span>
              <span>{{ formatPrice(getPaymentFee()) }}</span>
            </div>

            <!-- Coupon am√©lior√© -->
            <div class="coupon-section">
              <div class="coupon-header">
                <h4>üéÅ Code promo</h4>
                <button
                  class="btn-small"
                  (click)="showAvailableCoupons = !showAvailableCoupons"
                >
                  Voir les coupons disponibles
                </button>
              </div>

              <div *ngIf="showAvailableCoupons" class="available-coupons">
                <div
                  *ngFor="let coupon of availableCoupons"
                  class="coupon-option"
                  (click)="applyCoupon(coupon.code)"
                >
                  <div class="coupon-code">{{coupon.code}}</div>
                  <div class="coupon-desc">{{coupon.description}}</div>
                  <div class="coupon-expiry" *ngIf="coupon.expiry">
                    ‚è≥ {{coupon.expiry}}
                  </div>
                </div>
              </div>

              <div *ngIf="!appliedCoupon" class="coupon-input">
                <input
                  type="text"
                  [(ngModel)]="couponCode"
                  placeholder="Entrez votre code promo"
                  class="coupon-field"
                  (keyup.enter)="applyCoupon()"
                />
                <button
                  class="coupon-btn"
                  (click)="applyCoupon()"
                  [disabled]="!couponCode"
                >
                  Appliquer
                </button>
              </div>

              <div *ngIf="appliedCoupon" class="coupon-applied">
                <div class="coupon-info">
                  <span class="coupon-code">{{ appliedCoupon.code }}</span>
                  <span class="coupon-desc"
                    >{{ appliedCoupon.description }}</span
                  >
                  <span class="coupon-discount">
                    -{{ appliedCoupon.discount }}{{ appliedCoupon.type ===
                    'percentage' ? '%' : ' FCFA' }}
                  </span>
                </div>
                <div class="coupon-actions">
                  <button
                    class="coupon-share"
                    (click)="shareCoupon(appliedCoupon!.code)"
                  >
                    üì§
                  </button>
                  <button class="coupon-remove" (click)="removeCoupon()">
                    ‚úï
                  </button>
                </div>
              </div>
            </div>

            <div *ngIf="appliedCoupon" class="summary-row discount">
              <span>R√©duction coupon</span>
              <span>-{{ formatPrice(getCouponDiscount()) }}</span>
            </div>

            <!-- Estimation des points de fid√©lit√© -->
            <div class="loyalty-points" *ngIf="getLoyaltyPoints() > 0">
              <div class="points-icon">‚≠ê</div>
              <div class="points-content">
                <strong>{{getLoyaltyPoints()}} points de fid√©lit√©</strong>
                <span>√† gagner avec cette commande</span>
              </div>
            </div>
          </div>

          <div class="summary-total">
            <div class="total-label">
              <span>Total √† payer</span>
              <div class="tax-info">TVA incluse</div>
            </div>
            <div class="total-amount">{{ formatPrice(getTotal()) }}</div>
          </div>

          <div class="summary-installments" *ngIf="showInstallmentOptions()">
            <div
              class="installment-option"
              *ngFor="let option of getInstallmentOptions()"
              (click)="selectInstallmentOption(option)"
            >
              <span
                >{{option.months}} mois √ó
                {{formatPrice(option.monthlyPayment)}}</span
              >
              <span class="installment-total"
                >{{formatPrice(option.total)}}</span
              >
            </div>
          </div>
        </div>

        <!-- Options de livraison am√©lior√©es -->
        <div class="delivery-card">
          <h3>üì¶ Options de livraison</h3>

          <div class="delivery-time-estimate">
            ‚è±Ô∏è Livraison estim√©e: {{getEstimatedDeliveryTime()}}
          </div>

          <div class="delivery-options">
            <div
              *ngFor="let option of getFilteredDeliveryOptions()"
              class="delivery-option"
              [class.selected]="selectedDeliveryOption === option.id"
              [class.recommended]="option.recommended"
              (click)="selectDeliveryOption(option.id)"
            >
              <div class="option-header">
                <div class="option-info">
                  <div class="option-name">{{ option.name }}</div>
                  <div class="option-tags">
                    <span *ngIf="option.fastest" class="tag fastest"
                      >‚ö° Rapide</span
                    >
                    <span *ngIf="option.cheapest" class="tag cheapest"
                      >üí∞ √âconomique</span
                    >
                  </div>
                </div>
                <div class="option-price">{{ formatPrice(option.price) }}</div>
              </div>

              <div class="option-details">
                <div class="option-time">‚è±Ô∏è {{ option.time }}</div>
                <div class="option-availability" *ngIf="option.availableSlots">
                  üìÖ {{option.availableSlots}} cr√©neaux disponibles
                </div>
                <p class="option-description">{{ option.description }}</p>
                <div class="option-features" *ngIf="option.features">
                  <span *ngFor="let feature of option.features" class="feature">
                    ‚úÖ {{feature}}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Adresse de livraison am√©lior√©e -->
          <div
            *ngIf="selectedDeliveryOption.includes('delivery')"
            class="delivery-address"
          >
            <div class="address-header">
              <h4>üìç Adresse de livraison</h4>
              <button class="btn-small" (click)="useCurrentLocation()">
                üìç Utiliser ma position
              </button>
            </div>

            <div class="address-form">
              <div class="form-group">
                <label>Adresse compl√®te *</label>
                <input
                  type="text"
                  [(ngModel)]="deliveryAddress.street"
                  placeholder="Rue, num√©ro, b√¢timent..."
                  class="form-input"
                  [class.error]="addressErrors.street"
                />
                <div *ngIf="addressErrors.street" class="error-message">
                  {{addressErrors.street}}
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Ville *</label>
                  <select [(ngModel)]="deliveryAddress.city" class="form-input" title="S√©lectionnez une ville" >
                    <option value="">S√©lectionnez une ville</option>
                    <option value="Dakar">Dakar</option>
                    <option value="Thi√®s">Thi√®s</option>
                    <option value="Saint-Louis">Saint-Louis</option>
                    <option value="Ziguinchor">Ziguinchor</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Code postal</label>
                  <input
                    type="text"
                    [(ngModel)]="deliveryAddress.zipCode"
                    placeholder="Code postal"
                    class="form-input"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>T√©l√©phone *</label>
                  <input
                    type="tel"
                    [(ngModel)]="deliveryAddress.phone"
                    placeholder="+221 XX XXX XX XX"
                    class="form-input"
                    [class.error]="addressErrors.phone"
                  />
                  <div *ngIf="addressErrors.phone" class="error-message">
                    {{addressErrors.phone}}
                  </div>
                </div>

                <div class="form-group">
                  <label>Adresse email</label>
                  <input
                    type="email"
                    [(ngModel)]="deliveryAddress.email"
                    placeholder="email@exemple.com"
                    class="form-input"
                  />
                </div>
              </div>

              <div class="form-group">
                <label>Instructions de livraison (optionnel)</label>
                <textarea
                  [(ngModel)]="deliveryAddress.instructions"
                  placeholder="Porte, √©tage, code d'entr√©e, lieu de d√©p√¥t..."
                  class="form-textarea"
                  rows="3"
                ></textarea>
              </div>

              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="saveAddress" />
                  <span class="checkbox-custom"></span>
                  <span
                    >Sauvegarder cette adresse pour les prochaines
                    commandes</span
                  >
                </label>
              </div>
            </div>
          </div>

          <!-- Points de retrait -->
          <div
            *ngIf="selectedDeliveryOption.includes('pickup')"
            class="pickup-points"
          >
            <h4>üìç Points de retrait disponibles</h4>
            <div class="pickup-options">
              <div
                *ngFor="let point of pickupPoints"
                class="pickup-option"
                [class.selected]="selectedPickupPoint === point.id"
                (click)="selectPickupPoint(point.id)"
              >
                <div class="pickup-name">{{point.name}}</div>
                <div class="pickup-address">{{point.address}}</div>
                <div class="pickup-hours">üïí {{point.hours}}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- M√©thodes de paiement am√©lior√©es -->
        <div class="payment-card">
          <h3>üí≥ M√©thode de paiement</h3>

          <div class="payment-options">
            <div
              *ngFor="let method of getFilteredPaymentMethods()"
              class="payment-option"
              [class.selected]="selectedPaymentMethod === method.id"
              [class.recommended]="method.recommended"
              (click)="selectedPaymentMethod = method.id"
            >
              <div class="payment-icon">{{ method.icon }}</div>
              <div class="payment-info">
                <div class="payment-name">{{ method.name }}</div>
                <div class="payment-description">{{ method.description }}</div>
                <div class="payment-promo" *ngIf="method.promo">
                  üéÅ {{method.promo}}
                </div>
              </div>
              <div class="payment-fee">
                {{ method.fee > 0 ? '+' + formatPrice(method.fee) : 'Gratuit' }}
              </div>
            </div>
          </div>

          <!-- Paiement en plusieurs fois -->
          <div *ngIf="showInstallmentOptions()" class="installment-toggle">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="useInstallments" />
              <span class="checkbox-custom"></span>
              <span>Payer en plusieurs fois</span>
            </label>
          </div>

          <!-- Section de s√©curit√© -->
          <div class="payment-security">
            <div class="security-icons">
              <span>üîí</span>
              <span>üõ°Ô∏è</span>
              <span>‚úÖ</span>
            </div>
            <div class="security-info">
              <strong>Paiement 100% s√©curis√©</strong>
              <span
                >Cryptage SSL ‚Ä¢ Garantie blockchain ‚Ä¢ Protection des
                donn√©es</span
              >
            </div>
          </div>
        </div>

        <!-- Bouton de commande am√©lior√© -->
        <div class="checkout-card">
          <div class="checkout-summary">
            <div class="checkout-total">
              <span>Total √† payer</span>
              <span class="amount">{{ formatPrice(getTotal()) }}</span>
            </div>

            <div class="checkout-details">
              <div class="detail-item">
                <span>Dont TVA:</span>
                <span>{{ formatPrice(calculateTax()) }}</span>
              </div>
              <div class="detail-item" *ngIf="getCouponDiscount() > 0">
                <span>Dont r√©duction:</span>
                <span>-{{ formatPrice(getCouponDiscount()) }}</span>
              </div>
            </div>

            <p class="checkout-note">
              <span>üîí Paiement s√©curis√©</span>
              <span>üõ°Ô∏è Garantie blockchain</span>
              <span>‚úÖ Satisfaction garantie</span>
            </p>
          </div>

          <div class="checkout-buttons">
            <button
              class="checkout-btn btn-primary"
              (click)="proceedToCheckout()"
              [disabled]="!canCheckout() || isCheckingOut"
              [class.loading]="isCheckingOut"
            >
              <span *ngIf="!isCheckingOut" class="btn-content">
                <span class="btn-icon">‚úÖ</span>
                Commander maintenant
                <span class="btn-subtext">{{ formatPrice(getTotal()) }}</span>
              </span>

              <span *ngIf="isCheckingOut" class="btn-content">
                <span class="spinner"></span>
                Traitement en cours...
              </span>
            </button>

            <button class="checkout-btn btn-secondary" (click)="requestQuote()">
              üìã Demander un devis
            </button>

            <button
              class="checkout-btn btn-tertiary"
              (click)="saveOrderAsDraft()"
            >
              üíæ Enregistrer comme brouillon
            </button>
          </div>

          <div class="checkout-guarantees">
            <div class="guarantee">
              <span>üöö Livraison garantie</span>
              <span class="guarantee-desc">ou rembours√©</span>
            </div>
            <div class="guarantee">
              <span>üîÑ 48h pour changer d'avis</span>
            </div>
            <div class="guarantee">
              <span>üìû Support 7j/7</span>
            </div>
          </div>

          <p class="secure-payment">
            Votre paiement est prot√©g√© par notre syst√®me de s√©curit√© blockchain
          </p>
        </div>
      </div>
    </div>

    <!-- Conseils et informations am√©lior√©s -->
    <div class="cart-tips">
      <div class="tip-card">
        <h4>üí° Pourquoi acheter chez nous ?</h4>
        <ul>
          <li>‚úÖ Produits certifi√©s blockchain</li>
          <li>‚úÖ Producteurs v√©rifi√©s et not√©s</li>
          <li>‚úÖ Paiements s√©curis√©s multicanal</li>
          <li>‚úÖ Livraison garantie et tra√ßable</li>
          <li>‚úÖ Frais de port r√©duits d√®s 3 articles</li>
        </ul>
      </div>

      <div class="tip-card">
        <h4>üõ°Ô∏è Nos garanties incluses</h4>
        <ul>
          <li>Authenticit√© v√©rifi√©e par QR code</li>
          <li>Tra√ßabilit√© compl√®te du produit</li>
          <li>Remboursement sous 48h si probl√®me</li>
          <li>Support client 7j/7 par WhatsApp</li>
          <li>Programme de fid√©lit√© avec r√©compenses</li>
        </ul>
      </div>

      <div class="tip-card">
        <h4>üì± Acheter en toute confiance</h4>
        <p>
          Scannez les QR codes pour v√©rifier l'authenticit√© de chaque produit
          avant l'achat.
        </p>
        <div class="tip-actions">
          <button routerLink="/buyer/scan" class="scan-btn">
            üì± Tester le scanner
          </button>
          <button (click)="showVerificationInfo()" class="info-btn">
            ‚ÑπÔ∏è En savoir plus
          </button>
        </div>
      </div>

      <div class="tip-card">
        <h4>üå± Impact environnemental</h4>
        <div class="impact-stats">
          <div class="impact-stat">
            <span class="stat-value">{{calculateCarbonSavings()}} kg</span>
            <span class="stat-label">CO2 √©conomis√©</span>
          </div>
          <div class="impact-stat">
            <span class="stat-value">{{countLocalProducers()}}</span>
            <span class="stat-label">Producteurs locaux</span>
          </div>
          <div class="impact-stat">
            <span class="stat-value">{{calculateWaterSaved()}} L</span>
            <span class="stat-label">Eau pr√©serv√©e</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Widget de progression de commande -->
    <div class="order-progress">
      <div class="progress-steps">
        <div class="step active">
          <div class="step-number">1</div>
          <div class="step-label">Panier</div>
        </div>
        <div class="step" [class.active]="canCheckout()">
          <div class="step-number">2</div>
          <div class="step-label">Livraison</div>
        </div>
        <div
          class="step"
          [class.active]="canCheckout() && selectedPaymentMethod"
        >
          <div class="step-number">3</div>
          <div class="step-label">Paiement</div>
        </div>
        <div class="step">
          <div class="step-number">4</div>
          <div class="step-label">Confirmation</div>
        </div>
      </div>
      <div class="progress-bar">
        <div
          class="progress-fill"
          [style.width.%]="getCheckoutProgress()"
        ></div>
      </div>
    </div>
  </div>

  <!-- Modal pour le partage du panier -->
  <div *ngIf="showShareModal" class="modal-overlay" (click)="closeShareModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>üì§ Partager mon panier</h3>
      <p>Partagez votre panier avec vos amis ou votre famille</p>
      <div class="share-options">
        <button class="share-option" (click)="shareViaWhatsApp()">
          <span>üì± WhatsApp</span>
        </button>
        <button class="share-option" (click)="shareViaEmail()">
          <span>üìß Email</span>
        </button>
        <button class="share-option" (click)="copyCartLink()">
          <span>üîó Copier le lien</span>
        </button>
      </div>
      <div class="modal-actions">
        <button class="btn-secondary" (click)="closeShareModal()">
          Annuler
        </button>
      </div>
    </div>
  </div>
  <!-- Modal de confirmation de commande -->
  <div
    *ngIf="showOrderConfirmation"
    class="modal-overlay confirmation-modal"
    (click)="closeOrderConfirmation()"
  >
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üéâ Commande Confirm√©e !</h2>
        <button class="modal-close" (click)="closeOrderConfirmation()">
          √ó
        </button>
      </div>

      <div class="modal-body">
        <div class="confirmation-icon">‚úÖ</div>
        <h3>Merci pour votre commande !</h3>

        <div class="confirmation-details">
          <div class="detail-item">
            <span class="detail-label">Num√©ro de commande</span>
            <span class="detail-value"
              >{{orderConfirmationData?.orderNumber}}</span
            >
          </div>
          <div class="detail-item">
            <span class="detail-label">Total</span>
            <span class="detail-value"
              >{{formatPrice(orderConfirmationData?.total || 0)}}</span
            >
          </div>
          <div class="detail-item">
            <span class="detail-label">Articles</span>
            <span class="detail-value"
              >{{orderConfirmationData?.itemsCount}} produit(s)</span
            >
          </div>
          <div class="detail-item">
            <span class="detail-label">Statut</span>
            <span class="detail-value status-pending"
              >En attente de confirmation</span
            >
          </div>
          <div
            class="detail-item"
            *ngIf="orderConfirmationData?.estimatedDelivery"
          >
            <span class="detail-label">Livraison estim√©e</span>
            <span class="detail-value">{{getEstimatedDeliveryTime()}}</span>
          </div>
        </div>

        <div class="confirmation-message">
          <p>Votre commande a √©t√© enregistr√©e avec succ√®s.</p>
          <p>
            Vous recevrez une notification lorsque le producteur confirmera
            votre commande.
          </p>

          <div
            class="confirmation-alert"
            *ngIf="orderConfirmationData?.isFirstOrder"
          >
            <strong>üéÅ Bienvenue chez Jokko Agro !</strong>
            <p>
              Pour votre premi√®re commande, vous recevez
              <strong>100 points de fid√©lit√©</strong>.
            </p>
          </div>
        </div>

        <div class="next-steps">
          <h4>Prochaines √©tapes :</h4>
          <ul>
            <li>üì± Le producteur va confirmer votre commande sous 24h</li>
            <li>üí¨ Vous serez notifi√© par WhatsApp/SMS</li>
            <li>üîÑ Suivez l'avancement dans "Mes commandes"</li>
            <li>üìû Contactez-nous en cas de question</li>
          </ul>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeOrderConfirmation()">
          Continuer mes achats
        </button>
        <button class="btn btn-primary" (click)="goToOrders()">
          üìã Voir mes commandes
        </button>
      </div>
    </div>
  </div>
</div>
